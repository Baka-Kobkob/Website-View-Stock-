<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NexTopup | Admin Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f1f5f9; }
        .admin-card { background: white; border-radius: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); }
        .input-field { background: #f8fafc; border: 2px solid #f1f5f9; border-radius: 15px; padding: 12px 16px; outline: none; transition: 0.2s; font-weight: 600; }
        .input-field:focus { border-color: #3b82f6; background: white; }
    </style>
</head>
<body class="pb-20">

    <div class="max-w-md mx-auto p-6 space-y-8">
        <div class="flex justify-between items-center bg-slate-900 p-6 rounded-[30px] text-white shadow-xl">
            <div>
                <h1 class="text-xl font-black italic tracking-widest">ADMIN PANEL</h1>
                <p class="text-[10px] font-bold opacity-60 uppercase">Database: MongoDB Connected</p>
            </div>
            <button onclick="location.reload()" class="p-2 bg-white/10 rounded-full hover:bg-white/20">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg>
            </button>
        </div>

        <div class="admin-card p-6 border-t-4 border-blue-600">
            <h2 class="text-[11px] font-black text-slate-400 uppercase mb-5 tracking-[2px]">á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á•á›á·áá•á›</h2>
            
            <div class="flex flex-col gap-3">
                <input type="hidden" id="edit-id">
                <input type="text" id="p-name" class="input-field" placeholder="Product Name (e.g. 86 ğŸ’)">
                
                <div class="flex gap-2">
                    <div class="flex-1">
                        <label class="text-[9px] font-bold text-slate-400 ml-2">COST ($)</label>
                        <input type="number" id="p-cost" class="input-field w-full" placeholder="0.00">
                    </div>
                    <div class="flex-1">
                        <label class="text-[9px] font-bold text-slate-400 ml-2">PRICE ($)</label>
                        <input type="number" id="p-price" class="input-field w-full" placeholder="0.00">
                    </div>
                </div>

                <button onclick="saveProduct()" id="save-btn" class="w-full py-4 bg-blue-600 text-white rounded-2xl font-black text-xs uppercase shadow-lg shadow-blue-100 mt-2 active:scale-95 transition-all">
                    ášá€áŸ’áŸá¶á‘á»á€á•á›á·áá•á›
                </button>
                <button onclick="clearForm()" id="cancel-btn" class="hidden w-full py-2 text-slate-400 font-bold text-[10px] uppercase">Cancel Edit</button>
            </div>
        </div>

        <div class="space-y-3">
            <h3 class="text-[11px] font-black text-slate-400 uppercase ml-2 tracking-[2px]">á”á‰áŸ’á‡á¸á•á›á·áá•á›á€áŸ’á“á»á„á á¶á„</h3>
            <div id="product-list" class="space-y-3">
                </div>
        </div>

        <div class="space-y-3">
            <h3 class="text-[11px] font-black text-slate-400 uppercase ml-2 tracking-[2px]">á€á¶ášá€á»á˜áŸ’á˜áŸ‰á„áŸ‹ááŸ’á˜á¸áŸ— (Orders)</h3>
            <div id="order-list" class="space-y-4">
                </div>
        </div>
    </div>

    <script>
        // á”áŸ’áá¼áš Link á“áŸáŸ‡á‘áŸ…áá¶á˜ Link Admin á–á·áá”áŸ’ášá¶á€áŠášá”áŸáŸ‹á¢áŸ’á“á€
        const API_URL = "/api"; 
        let allProducts = [];

        async function loadData() {
            try {
                const res = await fetch(`${API_URL}/data`);
                const data = await res.json();
                
                // á”á„áŸ’á á¶á‰á•á›á·áá•á›
                allProducts = data.products;
                renderProducts(data.products);
                
                // á”á„áŸ’á á¶á‰ Orders
                renderOrders(data.orders);
            } catch (e) { console.error("Load error:", e); }
        }

        function renderProducts(products) {
            const list = document.getElementById('product-list');
            list.innerHTML = products.map(p => `
                <div class="bg-white p-4 rounded-2xl flex justify-between items-center shadow-sm border border-slate-50">
                    <div>
                        <p class="font-black text-slate-800 text-sm">${p.name}</p>
                        <p class="text-[10px] font-bold text-blue-500">$${p.price} <span class="text-slate-300 ml-1">Cost: $${p.cost}</span></p>
                    </div>
                    <button onclick="editProduct('${p._id}')" class="px-4 py-2 bg-slate-100 text-slate-600 rounded-xl text-[10px] font-black uppercase hover:bg-blue-600 hover:text-white transition-all">Edit</button>
                </div>
            `).join('');
        }

        function renderOrders(orders) {
            const list = document.getElementById('order-list');
            if (orders.length === 0) {
                list.innerHTML = `<p class="text-center text-xs font-bold text-slate-400 py-10 bg-white rounded-[30px]">á˜á·á“á‘á¶á“áŸ‹á˜á¶á“á€á¶ášá€á»á˜áŸ’á˜áŸ‰á„áŸ‹á“áŸ…á¡á¾á™</p>`;
                return;
            }
            list.innerHTML = orders.map(o => `
                <div class="bg-white p-5 rounded-[30px] border-l-8 border-blue-600 shadow-sm space-y-3">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-[10px] font-black text-slate-400 uppercase leading-none mb-1">á¢áá·áá·á‡á“</p>
                            <p class="font-black text-slate-800 text-sm italic">${o.player}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-[10px] font-black text-slate-400 uppercase leading-none mb-1">á•á›á·áá•á›</p>
                            <p class="font-black text-blue-600 text-sm italic">${o.product}</p>
                        </div>
                    </div>
                    <p class="text-[9px] text-slate-400 font-bold uppercase tracking-wider bg-slate-50 p-2 rounded-lg border">ID: ${o.id} | ${o.date}</p>
                    <img src="${o.receipt}" class="w-full h-48 object-cover rounded-2xl border cursor-pointer hover:opacity-90" onclick="window.open(this.src)">
                </div>
            `).join('');
        }

        async function saveProduct() {
            const id = document.getElementById('edit-id').value;
            const name = document.getElementById('p-name').value;
            const cost = document.getElementById('p-cost').value;
            const price = document.getElementById('p-price').value;

            if(!name || !price) return alert("áŸá¼á˜á”áŸ†á–áŸá‰áˆáŸ’á˜áŸ„áŸ‡ á“á·á„áá˜áŸ’á›áŸƒ!");

            const btn = document.getElementById('save-btn');
            btn.innerText = "á€áŸ†á–á»á„ášá€áŸ’áŸá¶á‘á»á€...";
            btn.disabled = true;

            try {
                const res = await fetch(`${API_URL}/products`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: id || null, name, cost, price })
                });
                
                if (res.ok) {
                    alert("á‡áŸ„á‚á‡áŸá™!");
                    clearForm();
                    loadData();
                }
            } catch (e) { alert("Error saving product"); }
            
            btn.innerText = "ášá€áŸ’áŸá¶á‘á»á€á•á›á·áá•á›";
            btn.disabled = false;
        }

        function editProduct(id) {
            const p = allProducts.find(item => item._id === id);
            if (!p) return;
            
            document.getElementById('edit-id').value = p._id;
            document.getElementById('p-name').value = p.name;
            document.getElementById('p-cost').value = p.cost;
            document.getElementById('p-price').value = p.price;
            
            document.getElementById('save-btn').innerText = "Update Product";
            document.getElementById('cancel-btn').classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function clearForm() {
            document.getElementById('edit-id').value = "";
            document.getElementById('p-name').value = "";
            document.getElementById('p-cost').value = "";
            document.getElementById('p-price').value = "";
            document.getElementById('save-btn').innerText = "ášá€áŸ’áŸá¶á‘á»á€á•á›á·áá•á›";
            document.getElementById('cancel-btn').classList.add('hidden');
        }

        // á…á¶á”áŸ‹á•áŸ’áŠá¾á˜
        loadData();
    </script>
</body>
</html>
