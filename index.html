<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 p-6">
    <div class="max-w-2xl mx-auto space-y-6">
        
        <div class="bg-white p-8 rounded-[30px] shadow-sm border">
            <h1 class="text-2xl font-black text-blue-600 mb-6 uppercase italic">Admin Settings</h1>
            
            <div class="mb-8">
                <label class="block text-xs font-bold text-slate-400 mb-2 uppercase">Logo Text</label>
                <input type="text" id="logo-input" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-500" placeholder="á§á‘á¶á ášááŸ: BLUE">
            </div>

            <hr class="mb-8">

            <h2 class="font-bold text-slate-700 mb-4">á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á€á‰áŸ’á…á”áŸ‹ Diamond</h2>
            
            <div class="grid grid-cols-2 gap-3 mb-4">
                <input type="number" id="add-amount" placeholder="á…áŸ†á“á½á“ Diamond" class="p-4 bg-slate-50 border rounded-2xl outline-none">
                <input type="number" step="0.01" id="add-price" placeholder="áá˜áŸ’á›áŸƒ ($)" class="p-4 bg-slate-50 border rounded-2xl outline-none">
                <button onclick="addPriceLocal()" class="col-span-2 bg-blue-600 text-white py-4 rounded-2xl font-bold hover:bg-blue-700 transition">á”á“áŸ’ááŸ‚á˜á…á¼á›á”á‰áŸ’á‡á¸</button>
            </div>

            <div id="price-list-admin" class="space-y-2 mb-8">
                </div>

            <button onclick="saveAllToDB()" class="w-full bg-green-500 text-white py-5 rounded-[25px] font-black text-lg shadow-lg shadow-green-200 active:scale-95 transition">
                SAVE TO DATABASE
            </button>
        </div>

    </div>

    <script>
        const API_URL = "https://website-view-stock.vercel.app/api";
        let localPrices = [];

        // áŸ¡. á‘á¶á‰á‘á·á“áŸ’á“á“áŸá™á…á¶áŸáŸ‹á˜á€á”á„áŸ’á á¶á‰
        async function fetchCurrentConfig() {
            const res = await fetch(`${API_URL}/config`);
            const data = await res.json();
            document.getElementById('logo-input').value = data.logoText || "NEXTOPUP";
            localPrices = data.prices || [];
            renderList();
        }

        // áŸ¢. á”á“áŸ’ááŸ‚á˜áá˜áŸ’á›áŸƒá‘áŸ…á€áŸ’á“á»á„ List á”ááŸ’ááŸ„áŸ‡á¢á¶áŸá“áŸ’á“
        function addPriceLocal() {
            const amount = document.getElementById('add-amount').value;
            const price = document.getElementById('add-price').value;
            if(!amount || !price) return alert("áŸá¼á˜á”áŸ†á–áŸá‰á±áŸ’á™á‚áŸ’ášá”áŸ‹!");

            localPrices.push({ amount, price });
            renderList();

            document.getElementById('add-amount').value = "";
            document.getElementById('add-price').value = "";
        }

        // áŸ£. á›á»á”á…áŸá‰á–á¸ List
        function removePrice(index) {
            localPrices.splice(index, 1);
            renderList();
        }

        // áŸ¤. á”á„áŸ’á á¶á‰á”á‰áŸ’á‡á¸á€áŸ’á“á»á„ UI
        function renderList() {
            const container = document.getElementById('price-list-admin');
            container.innerHTML = localPrices.map((p, i) => `
                <div class="flex justify-between items-center p-4 bg-slate-50 border rounded-2xl">
                    <span class="font-bold text-slate-700">${p.amount} ğŸ’ = $${p.price}</span>
                    <button onclick="removePrice(${i})" class="text-red-500 font-bold text-xs uppercase">á›á»á”</button>
                </div>
            `).join('');
        }

        // áŸ¥. á•áŸ’á‰á¾á‘á·á“áŸ’á“á“áŸá™á‘á¶áŸ†á„á¢áŸáŸ‹á‘áŸ…ášá€áŸ’áŸá¶á‘á»á€á€áŸ’á“á»á„ MongoDB
        async function saveAllToDB() {
            const logo = document.getElementById('logo-input').value;
            
            const payload = {
                adminKey: "112233",
                logoText: logo,
                prices: localPrices
            };

            const res = await fetch(`${API_URL}/admin/update`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            if(res.ok) {
                alert("ášá€áŸ’áŸá¶á‘á»á€á‡áŸ„á‚á‡áŸá™! áá˜áŸ’á›áŸƒá“á¹á„á”á„áŸ’á á¶á‰ááŸ’ášá¹á˜ááŸ’ášá¼áœá“áŸ… Home PageáŸ”");
            } else {
                alert("á”ášá¶á‡áŸá™! áŸá¼á˜á–á·á“á·ááŸ’á™ Admin KeyáŸ”");
            }
        }

        fetchCurrentConfig();
    </script>
</body>
</html>
